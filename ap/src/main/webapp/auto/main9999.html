

 
 
   
<script src="jquery.js" > </script> 
<script src="utils.js"> </script>
<script src="pro.js"> </script> 
<script src="worker-timer.js"> </script> 
<script src="timer-worker.js"> </script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/md5.js" > </script>
<script type="text/javascript" src="http://www.myersdaily.org/joseph/javascript/md5.js"></script>

<script>
	 class Car {
		  
		 constructor(phase) {
			    this.betHis = { } ;
				this.phase = phase; 
				this.projectIndex = {
				    	'1' : { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, '10' : 0,} ,
				    	'2' : { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, '10' : 0,} ,
				    	'3' : { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, '10' : 0,} ,
				    	'4' : { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, '10' : 0,} ,
				    	'5' : { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, '10' : 0,} ,
				    	'6' : { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, '10' : 0,} ,
				    	'7' : { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, '10' : 0,} ,
				    	'8' : { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, '10' : 0,} ,
				    	'9' : { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, '10' : 0,} ,
				    	'10' : { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, '10' : 0,} ,

			 };

		 }
		 
		 getProjectIndex(){
			 return this.projectIndex ;
			 
		 }
		 
		 compute(code){
			 let arr = code.split(',');
			 for(let x = 0 ; x < arr.length ; x++){
				 let sn = x + 1;
				 for(let i = 1;i<11;i++){
			 			this.projectIndex[sn][i] ++ ;
		 		 }
				 this.projectIndex[sn][arr[x]] = 0 ;
			 }
			 
			
		 }
		 
		 betCode(phase){ 
			 let betPhase = phase * 1 + 1;
			 for(let x = 1 ; x<11 ; x++){
				 
				 	//let cover = this.betHis.x ? this.betHis.x.c : 0 ;
				 	//let betCode = '';
				 	if(this.betHis[x]){
				 		let betCode = this.betHis[x].code; //已下之號碼
				 		let betedphase = this.betHis[x].betPhase; //已下的期數
				 		let openCc = his.getCodeByPhaseBySn(betedphase,x);
				 		
				 		
				 		this.betHis[x] = { 
									c: this.betHis.x.c + 1 , 
									code: this.betHis[x].code,
									betPhase: betPhase 
						}
				 	}else {
				 		let tenArray = [];
					 	 
				 		for(let i = 1;i<11;i++){
				 			if(this.projectIndex[x][i] >=16){ tenArray.push(i);};
				 		} 
				 		
				 		if(tenArray.length ==4){ 
							this.betHis[x] = { 
										c: 1 , 
										code: tenArray.sort(sortNumber),
										betPhase: betPhase  
							}
							//betJson[x] = tenArray.sort(sortNumber);
							
							//return tenArray.sort(sortNumber); 
						} 
				 		
				 		
				 	}
				 	
			 		 
					
				 
			 }
			   
				
			//	return betJson;   
		 }
		 
		 sortNumber(a,b){
			return a - b
		 }
		 
		 
	 }
	 
	 class history {
		 constructor() {
			 this.history = {};
		 }
		 setHistory(data){
			 let temp ='';
			 for(let i in data){ 
				 if(!temp){
					 temp = i*1;
				 }else if(i*1 > temp) {
					 temp = i*1;
				 }
				 this.maxPhase = temp;
				 this.history[i] = data[i] ;
			 }
		 } 
		 getHistory(){ 
			 return this.history ;
		 }
		 
		 getMaxPhase(){ 
			 return  this.maxPhase  ;
		 }
		 
		 getCodeByPhase(phase){
			// console.log(this.history)
			 return this.history[phase];
		 }
		 
		 getCodeByPhaseBySn(phase,sn){
			 let code = this.history[phase];
			 let cc = code.toString().split(',')[sn*1 -1];
			 return cc;
		 }
		 
	 }
 	
	 
 	let u = getUrl();
	let his = new history();
    $(document).ready(function(){ 
      	 
		 getHistoryTimeout();//取得歷史記錄

	});
	 
    
   
	function getHistoryTimeout() { 
			workerTimer_timeout.setInterval(function () { 
			 		 let url = u + '/getHistory'; 
			       	 $.ajax({ url:  url, 
			    	         async: false,
			    	         success: function(data) { 
			    	        	    const json = JSON.parse(data);
			    	        	    his.setHistory(json); 
			    	        	    bet(his.getMaxPhase());
			    	        	    
		    	         	 }   	 
			          });
			       	// console.log(his.getHistory());
			       	 //console.log(his.getMaxPhase());

				    //getHistoryTimeout();
		    }, 5000);
	}
	
	let sub='';
	//let betFlag = false;
	function bet(phase) { 
		 
		if(sub=='' ||  (( phase * 1 ) - ( sub * 1 )) == 1){
			console.log('enter car');
			let car = new Car(phase);
			//console.log(phase);

			let code = his.getCodeByPhase(phase);
			 

			car.compute(code);
			car.betCode(phase);
			//console.log(car.getProjectIndex());
			sub = phase;
		}
		
		//if(betFlag)
			
		 
	}
	
</script>
 