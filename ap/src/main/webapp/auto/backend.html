
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">


<title>Login</title>

<!-- Bootstrap core CSS -->
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="dashboard.css" rel="stylesheet"> 
  
<style>
		table, th, td {
			border: 1px solid black;
			border-collapse: collapse;
			font-size: 14px;
			 
		}
		
		
		  .user_block{
	     overflow-y:scroll; 
	    	 height:65%;
		 
		 }
		 
		 
</style>
</head>


   
<div class="save_block">
			<table>
			    <tr>
					<td nowrap width="1%">
						會員帳號 
					</td>
					<td>
							 <input id="id" type ="text" size=35/>
					</td>
					
				</tr>
				 
				   <tr>
				 <td nowrap width="1%">
						系統密碼  
					</td>
					<td>
							 <input id="pwd" type ="text" size=35/>
					</td>
		        	</tr>
		        	 <tr>
				 <td nowrap width="1%">
						極速密碼  
					</td>
					<td>
							 <input id="pwd_in" type ="text" size=35/>
					</td>
		        	</tr>
			    <tr>
							<td nowrap>
								會員到期時間(YYYYMMDD) 
							</td>
							<td >
								  <input id="extendTime" type ="text" size=35/>
							</td>
		        </tr>
		         <tr>
							<td nowrap>
								備註
							</td>
							<td >
								  <input id="memo" type ="text" size=35/>
							</td>
		        </tr>
		        
		         <tr>
							 
							<td colspan=2>
								  <button type="button" onclick="save()">存檔</button>
							</td>
		        </tr>
			</table>	 
</div>

<div class="title">
		 帳號期限管理
</div>

   

<div class="user_block">
		 	 
</div>
<script src="jquery.js"> </script>
<script src="utils.js"> </script>	  

<link href="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.css" rel="stylesheet" type="text/css" />

 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
 <script src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.js" type="text/javascript"></script>

  <script src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.ui.position.min.js" type="text/javascript"></script>

    <script src="https://swisnl.github.io/jQuery-contextMenu/js/main.js" type="text/javascript"></script>
<script>
	$(document).ready(function(){
		load();
		let u = getUrl();
		
		

	         
	        
	})
	
	 function save(){
		if(document.getElementById("id").value ==''){alert('請輸入會員帳號'); return;}
		if(document.getElementById("extendTime").value ==''){alert('請輸入到期時間'); return;}
		if(document.getElementById("pwd").value ==''){alert('請輸入系統密碼'); return;}
		if(document.getElementById("pwd_in").value ==''){alert('請輸入極速密碼'); return;}
		if(document.getElementById("memo").value ==''){alert('請輸入備註'); return;}

		let u = getUrl();
		 $.ajax({ url:  u + "/saveLIMITDATE?user="+document.getElementById("id").value+"&date="+document.getElementById("extendTime").value
			 +"&pwd="+document.getElementById("pwd").value+"&pwd_in="+document.getElementById("pwd_in").value
			 +"&memo="+document.getElementById("memo").value, 
	         async: false,
	         success: function(data) {
	        	 document.getElementById("id").value='';
	        	 document.getElementById("extendTime").value='';
	        	 document.getElementById("pwd").value='';
	        	 document.getElementById("pwd_in").value='';
	        	 document.getElementById("memo").value='';
	        	 alert("存檔成功!");
	        	 load();
	         	 }
	        });
	 }
	
	function loadID(id){
	 
		let u = getUrl();
		 $.ajax({ url:  u + "/loadID?id="+id, 
	         async: false,
	         success: function(data) {
	        	var limitDate = data.split(',')[0];
	        	var sysPwd = data.split(',')[1];
	        	var startDate = data.split(',')[2];
	        	var pwd = data.split(',')[3];
	        	var memo = data.split(',')[4];

	        	document.getElementById("id").value = id;
	        	document.getElementById("extendTime").value = limitDate;
	        	document.getElementById("pwd").value = sysPwd;
	        	document.getElementById("pwd_in").value = pwd;
	        	document.getElementById("memo").value = memo;
 
         	 }
        });
	 }
	
	function load(){
		let u = getUrl();
		 $.ajax({ url:  u + "/loadLimitDate", 
	         async: false,
	         success: function(data) {
	        		$( "div.user_block" ).html(data);
	        		 $.contextMenu({
	     	            selector: '.context-menu-one', 
	     	            callback: function(key, options) {
	     	                var m = "clicked: " + key;
	     	                var id = decodeURI($(this).text()).trim();
	     	            
	     	            	var r = confirm("確定要刪除帳號"+id +"?");
	     	    		    if (r == true) {
	     	    		    	 
	     	    			    let url = u + '/deleteID?id='+id; 
	     	    			   
	     	    			    $.ajax({ url:url, 
	     	    			         async: false,
	     	    			         success: function(data) {
	     	    			        	  alert("刪除成功!");
	     	    			        	  load();
	     	    			        	  
	     	    			        	  
	     	    		         	 }
	     	    		        });
	     	    			    
	     	    			    
	     	    			  
	     	    		    }
	     	            },
	     	            items: {
	     	                
	     	                "delete": {name: "刪除", icon: "delete"},
	     	                
	     	            }
	     	        });
	        		 
	        		 $('.context-menu-one').on('click', function(e){
	     	        	var id = decodeURI($(this).text()).trim();
	     	        	 
	     	            loadID(id)
	     	        })   
	         	 }
	        });
		
	}

</script>
	   