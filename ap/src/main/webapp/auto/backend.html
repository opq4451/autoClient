
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">


<title>Login</title>

<!-- Bootstrap core CSS -->
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="dashboard.css" rel="stylesheet"> 
  
  
  
<style>
		table, th, td {
			border: 1px solid black;
			border-collapse: collapse;
			font-size: 16px;
			 
		}
		
		
		  .user_block{
	     overflow-y:scroll; 
	    	 height:65%;
		 
		 }
		 
		 .user_block tr:hover {
		    background-color:yellow;
		}
</style>
</head>


   
<div class="save_block">
			<table>
			    <tr>
					<td nowrap width="1%">&nbsp;&nbsp;&nbsp;&nbsp;會員帳號 
					</td>
					
					
					<td>
							 <input id="id" type ="text" size=35/>
					</td>
					
					<td nowrap>
								&nbsp;&nbsp;&nbsp;&nbsp;姓名
							</td>
							<td >
								  <input id="memo3" type ="text" size=20/>
					</td>
					
				</tr>
				 
				   <td nowrap width="1%">
						&nbsp;&nbsp;&nbsp;&nbsp;系統密碼  
					</td>
					<td>
							 <input id="pwd" type ="text" size=35/>
					</td>
					<td nowrap width="1%">
						&nbsp;&nbsp;&nbsp;&nbsp;極速密碼  
					</td>
					<td width="99%">
							 <input id="pwd_in" type ="text" size=35/>
					</td>
			    <tr>
							<td nowrap>
								&nbsp;&nbsp;&nbsp;&nbsp;會員到期時間(YYYYMMDD) 
							</td>
							<td  >
								  <input id="extendTime" type ="text" size=35/>
							</td>
							
							<td nowrap>
								&nbsp;&nbsp;&nbsp;&nbsp;全部會員下注狀態
							</td>
							<td>
								    <select class="forcebet" >
									  <option value="0" >全部會員下注中</option>
									  <option value="1" >全部會員強制停止 </option> 
									</select> 
							</td>
		        </tr>
		         <tr>
							<td nowrap>
								&nbsp;&nbsp;&nbsp;&nbsp;遠端id
							</td>
							<td >
								  <input id="memo" type ="text" size=35/>
							</td>
							
							<td nowrap>
								&nbsp;&nbsp;&nbsp;&nbsp;股東
							</td>
							<td  >
								    <select class="boss" >
									  <option value="0" >崗</option>
									  <option value="1" >發</option> 
									</select> 
							</td>
		        </tr>
		         <tr>
							<td nowrap>
								&nbsp;&nbsp;&nbsp;&nbsp;遠端密碼
							</td>
							<td  >
								  <input id="memo2" type ="text" size=35/>
							</td>
							
							<td nowrap>
								&nbsp;&nbsp;&nbsp;&nbsp;板
							</td>
							<td  >
								    <select class="board" >
									  <option value="0" >極速</option>
									  <option value="1" >華山</option> 
									</select> 
							</td>
		        </tr>
		         <tr>
							
		        </tr>
		        
		         <tr>
							 
							<td colspan=4>&nbsp;&nbsp;&nbsp;&nbsp;
								  <button type="button" onclick="save()"  style="height:50px;width:150px">存檔</button>
								  <button type="button" onclick="save('copy')"  style="height:50px;width:150px">複製</button>
								  <button type="button" onclick="delete_id()"  style="height:50px;width:150px">刪除</button>
							</td>
		        </tr>
		        
		          <input id="key" type ="hidden" size=100/>
		          
			</table>	 
</div>

<div class="title">
		 &nbsp;&nbsp;&nbsp;&nbsp;帳號期限管理
</div>

   

<div class="user_block">
		 	 
</div>
<script src="jquery.js"> </script>
<script src="utils.js"> </script>	  

<link href="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.css" rel="stylesheet" type="text/css" />

 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
 <script src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.js" type="text/javascript"></script>

  <script src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.ui.position.min.js" type="text/javascript"></script>

    <script src="https://swisnl.github.io/jQuery-contextMenu/js/main.js" type="text/javascript"></script>
<script>
	$(document).ready(function(){
		load();
		let u = getUrl();
		
		
		 $('select.forcebet').change(function(){
             var force =  $( ".forcebet" ).val(); 
             let u = getUrl();
    		     $.ajax({ url:  u + "/setForce?force="+force, 
    	         async: false,
    	         success: function(data) {
    	        	  
    	        	 alert("存檔成功!"); 
    	         	 }
    	        });
             
        });
	         
		 
		 $('select.boss').change(function(){
			 load();       
        });
	        
	})
	
	 function save(str){
		if(document.getElementById("id").value ==''){alert('請輸入會員帳號'); return;}
		if(document.getElementById("extendTime").value ==''){alert('請輸入到期時間'); return;}
		if(document.getElementById("pwd").value ==''){alert('請輸入系統密碼'); return;}
		if(document.getElementById("pwd_in").value ==''){alert('請輸入極速密碼'); return;}
		if(document.getElementById("memo").value ==''){alert('請輸入遠端id'); return;}
		if(document.getElementById("memo2").value ==''){alert('請輸入遠端密碼'); return;}
		if(document.getElementById("memo3").value ==''){alert('請輸入姓名'); return;}
		 
		let u = getUrl();
		 $.ajax({ url:  u + "/saveLIMITDATE?user="+document.getElementById("id").value+"&date="+document.getElementById("extendTime").value
			 +"&pwd="+document.getElementById("pwd").value+"&pwd_in="+document.getElementById("pwd_in").value
			 +"&memo="+document.getElementById("memo").value+"&memo2="+document.getElementById("memo2").value+"&memo3="+document.getElementById("memo3").value
			 +"&key="+(str?'':document.getElementById("key").value) +"&boss="+$( ".boss" ).val()  +"&board="+$( ".board" ).val()  , 
	         async: false,
	         success: function(data) {
	        	 document.getElementById("id").value='';
	        	 document.getElementById("extendTime").value='';
	        	 document.getElementById("pwd").value='';
	        	 document.getElementById("pwd_in").value='';
	        	 document.getElementById("memo").value='';
	        	 document.getElementById("memo2").value='';
	        	 document.getElementById("memo3").value='';
	        	 alert("存檔成功!");
	        	 load();
	         	 }
	        });
	 }
	
	function loadID(id){
	 
		let u = getUrl();
		 $.ajax({ url:  u + "/loadID?id="+id, 
	         async: false,
	         success: function(data) {
	        	var limitDate = data.split(',')[0];
	        	var sysPwd = data.split(',')[1];
	        	var startDate = data.split(',')[2];
	        	var pwd = data.split(',')[3];
	        	var memo = data.split(',')[4];
	        	var memo2 = data.split(',')[5];
	        	var memo3 = data.split(',')[6];
	        	var boss = data.split(',')[7];
	        	var board = data.split(',')[8];
	        
	        	document.getElementById("id").value = id;
	        	document.getElementById("extendTime").value = limitDate;
	        	document.getElementById("pwd").value = sysPwd;
	        	document.getElementById("pwd_in").value = pwd;
	        	document.getElementById("memo").value = memo;
	        	document.getElementById("memo2").value = memo2;
	        	document.getElementById("memo3").value = memo3;
         	document.getElementById("key").value = id;
         	 
         	$( ".boss" ).val(boss) ;
         	$( ".board" ).val(board) ;
         	 }
        });
	 }
	
	function load(){
		let u = getUrl();
		 $.ajax({ url:  u + "/loadLimitDate?boss="+$( ".boss" ).val() , 
	         async: false,
	         success: function(data) { 
	        	    var r = JSON.parse(data);
	        	  
	        		$( "div.user_block" ).html(r.returnhtml);
	        		 $.contextMenu({
	     	            selector: '.context-menu-one', 
	     	            callback: function(key, options) {
	     	                var m = "clicked: " + key;
	     	                var id = decodeURI($(this).text()).trim();
	     	            
	     	            	var r = confirm("確定要刪除帳號"+id +"?");
	     	    		    if (r == true) {
	     	    		    	 
	     	    			    let url = u + '/deleteID?id='+id; 
	     	    			   
	     	    			    $.ajax({ url:url, 
	     	    			         async: false,
	     	    			         success: function(data) {
	     	    			        	  alert("刪除成功!");
	     	    			        	  load();
	     	    			        	  
	     	    			        	  
	     	    		         	 }
	     	    		        });
	     	    			    
	     	    			    
	     	    			  
	     	    		    }
	     	            },
	     	            items: {
	     	                
	     	                "delete": {name: "刪除", icon: "delete"},
	     	                
	     	            }
	     	        });
	        		 
	        		 $('.context-menu-one').on('click', function(e){
	     	        	var id = decodeURI($(this).text()).trim();
	     	        	 
	     	            loadID(id)
	     	        })   
	     	        
	     	        
	     	       hover();
	         	 }
	        });
		 
		 
		 	//load force
		    $.ajax({ url:  u + "/getForce", 
		         async: false,
		         success: function(data) { 
		        	 $( ".forcebet" ).val(data);
		         }
	        });
		
	}
	
	
	function hover(){
		$('.user_block tr').hover(function() {
			 
		    $(this).addClass('hover');
		}, function() {
		    $(this).removeClass('hover');
		});
		
	}
	
	function delete_id(){
		
	   	var r = confirm("確定要刪除帳號"+document.getElementById("id").value +"?");
		    if (r == true) {
		    	 
		    	  	    let url =  getUrl() + '/deleteID?id='+document.getElementById("id").value; 
				   
				    $.ajax({ url:url, 
				         async: false,
				         success: function(data) {
				        	  alert("刪除成功!");
				        	  load();
				        	  
				        	  
			         	 }
			        });
			    
			    
			  
		    }
		    
		  
	}

</script>
	   